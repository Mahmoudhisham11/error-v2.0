# نظام إدارة الخطوط والعمليات المالية

## نظرة عامة على المشروع

هذا المشروع هو تطبيق ويب مبني باستخدام **Next.js** لإدارة الخطوط الهاتفية والعمليات المالية (الإرسال والاستلام). التطبيق يستخدم **Firebase Firestore** كقاعدة بيانات ويوفر نظام إدارة كامل للعمليات اليومية والتقارير.

## التقنيات المستخدمة

- **Next.js 15.4.5** - إطار عمل React للواجهات الأمامية
- **React 19.0.0** - مكتبة JavaScript لبناء واجهات المستخدم
- **Firebase Firestore** - قاعدة بيانات NoSQL في الوقت الفعلي
- **React Icons** - مكتبة الأيقونات
- **CSS Modules** - لتنسيق المكونات

## البنية الأساسية للمشروع

```
error_one/
├── app/                    # صفحات التطبيق الرئيسية
│   ├── page.jsx           # الصفحة الرئيسية (Home)
│   ├── layout.jsx         # التخطيط الأساسي للتطبيق
│   ├── firebase.jsx       # إعدادات Firebase
│   ├── globals.css        # الأنماط العامة
│   ├── cards/             # صفحة إدارة الخطوط
│   ├── reports/           # صفحة التقارير
│   └── sittings/          # صفحة الإعدادات
├── components/            # المكونات القابلة لإعادة الاستخدام
│   ├── Login/            # مكون تسجيل الدخول
│   ├── Main/             # مكون الصفحة الرئيسية
│   └── SideBar/          # مكون القائمة الجانبية
└── public/               # الملفات الثابتة
```

---

## الصفحات والمكونات

### 1. الصفحة الرئيسية (`app/page.jsx`)

**الوظيفة:** نقطة الدخول الرئيسية للتطبيق

**ما تفعله:**
- تتحقق من حالة تسجيل الدخول للمستخدم
- إذا كان المستخدم مسجل دخول: تعرض مكون `Main` (الصفحة الرئيسية)
- إذا لم يكن مسجل دخول: تعرض مكون `Login` (صفحة تسجيل الدخول)
- تستخدم `localStorage` للتحقق من وجود بيانات المستخدم

**الحالة:**
- `logedin`: حالة تسجيل الدخول (true/false)

---

### 2. صفحة تسجيل الدخول (`components/Login/page.jsx`)

**الوظيفة:** إدارة تسجيل الدخول وإنشاء الحسابات الجديدة

**ما تفعله:**

#### تسجيل الدخول:
- التحقق من اسم المستخدم وكلمة المرور واسم الفرع
- التحقق من وجود المستخدم في قاعدة البيانات
- التحقق من صحة كلمة المرور
- التحقق من مطابقة اسم الفرع
- التحقق من حالة تفعيل الحساب (`permissions.active`)
- حفظ بيانات المستخدم في `localStorage` عند نجاح تسجيل الدخول

#### إنشاء حساب جديد:
- التحقق من عدم وجود اسم المستخدم مسبقاً
- إنشاء حساب جديد في قاعدة البيانات مع الصلاحيات الافتراضية
- الصلاحيات الافتراضية: `{cards: false, reports: false, active: false, sittings: false}`

**الحقول المطلوبة:**
- اسم المستخدم
- كلمة المرور
- اسم الفرع

**الحالة:**
- `active`: التبديل بين تسجيل الدخول وإنشاء حساب
- `userName`: اسم المستخدم
- `password`: كلمة المرور
- `shop`: اسم الفرع

---

### 3. الصفحة الرئيسية - المبيعات اليومية (`components/Main/page.jsx`)

**الوظيفة:** إدارة العمليات اليومية (الإرسال والاستلام)

**ما تفعله:**

#### عرض البيانات:
- عرض جميع الخطوط المتاحة للفرع الحالي
- عرض جميع العمليات اليومية للفرع
- حساب صافي الربح اليومي (مجموع العمولات)

#### تنفيذ العمليات:
- **عملية الإرسال:**
  - خصم المبلغ من رصيد الخط
  - خصم المبلغ من حد الإرسال الشهري
  - إضافة العملية إلى قاعدة البيانات

- **عملية الاستلام:**
  - إضافة المبلغ إلى رصيد الخط
  - خصم المبلغ من حد الاستلام الشهري
  - إضافة العملية إلى قاعدة البيانات

#### التحقق من الحدود:
- التحقق من وجود رصيد كافي للإرسال
- التحقق من عدم تجاوز حد الإرسال الشهري
- التحقق من عدم تجاوز حد الاستلام الشهري

#### إدارة العمليات:
- حذف عملية معينة مع إعادة الرصيد إلى حالته السابقة
- تقفيل اليوم: نقل جميع العمليات إلى التقارير وحذفها من العمليات اليومية

**الحقول:**
- نوع العملية (إرسال/استلام)
- رقم الخط
- اسم العميل
- المبلغ
- العمولة
- صافي المبلغ (محسوب تلقائياً)

**المعلومات المعروضة:**
- يمكن إرسال: الحد المتبقي للإرسال
- يمكن استلام: الحد المتبقي للاستلام
- رصيد الخط: الرصيد الحالي للخط

**الحالة:**
- `cards`: قائمة الخطوط
- `operations`: قائمة العمليات اليومية
- `isProcessing`: حالة معالجة العملية (لمنع الضغط المتكرر)
- `phone`: رقم الخط المحدد
- `amount`: المبلغ
- `commation`: العمولة
- `type`: نوع العملية (إرسال/استلام)
- `total`: صافي الربح اليومي

---

### 4. صفحة الخطوط (`app/cards/page.jsx`)

**الوظيفة:** إدارة الخطوط الهاتفية

**ما تفعله:**

#### عرض الخطوط:
- عرض جميع الخطوط الخاصة بالفرع الحالي في جدول
- عرض معلومات كل خط:
  - اسم المالك
  - رقم الخط
  - يمكن إرسال (حد الإرسال المتبقي)
  - يمكن استلام (حد الاستلام المتبقي)
  - الرصيد الحالي
  - الرقم القومي
- حساب إجمالي الرصيد لجميع الخطوط

#### البحث:
- البحث عن خط معين برقم الخط
- استخدام `datalist` لتسهيل البحث

#### إضافة خط جديد (للمستخدمين المصرح لهم فقط):
- إضافة خط جديد مع البيانات التالية:
  - اسم المالك
  - الرقم القومي
  - رقم الشريحة
  - الرصيد الحالي
  - ليميت الاستلام (الحد الشهري للاستلام)
  - ليميت الإرسال (الحد الشهري للإرسال)

#### تعديل خط (للمستخدمين المصرح لهم فقط):
- تعديل بيانات الخط:
  - اسم المالك
  - الرقم القومي
  - رقم الشريحة
  - الرصيد الحالي

#### حذف خط (للمستخدمين المصرح لهم فقط):
- حذف خط من قاعدة البيانات

#### إدارة الحدود الشهرية:
- إعادة ضبط الحدود الشهرية تلقائياً في بداية كل شهر
- الحفاظ على الحدود الأصلية (`originalDepositLimit`, `originalWithdrawLimit`)
- حساب حد الاستلام بناءً على الرصيد الحالي

**الصلاحيات:**
- فقط المستخدمون التاليون يمكنهم إضافة/تعديل/حذف الخطوط:
  - "محمد شعبان ايرور 3"
  - "محمد شعبان ايرور 2"
  - "محمد شعبان ايرور 1"
  - "admin1"

**الحالة:**
- `cards`: قائمة الخطوط
- `add`: عرض/إخفاء نموذج الإضافة
- `openEdit`: فتح/إغلاق نموذج التعديل
- `active`: التبويب النشط (كل الخطوط/إضافة خط جديد)
- `search`: نص البحث
- `total`: إجمالي الرصيد

---

### 5. صفحة التقارير (`app/reports/page.jsx`)

**الوظيفة:** عرض التقارير اليومية للعمليات

**ما تفعله:**

#### عرض التقارير:
- عرض جميع التقارير ليوم محدد
- عرض معلومات كل تقرير:
  - الرقم المستخدم
  - نوع العملية (إرسال/استلام)
  - المبلغ
  - العمولة
  - إجمالي المبلغ (المبلغ - العمولة)
  - اسم العميل
  - التاريخ

#### اختيار التاريخ:
- اختيار تاريخ معين لعرض تقاريره
- التاريخ الافتراضي: اليوم الحالي

#### حساب الأرباح:
- حساب صافي ربح اليوم (مجموع العمولات)

#### طباعة PDF:
- إمكانية طباعة التقرير كملف PDF

**الحالة:**
- `selectedDate`: التاريخ المحدد
- `reports`: قائمة التقارير
- `total`: صافي الربح اليومي

---

### 6. صفحة الإعدادات (`app/sittings/page.jsx`)

**الوظيفة:** إدارة المستخدمين والصلاحيات

**ما تفعله:**

#### إدارة المستخدمين:
- عرض قائمة جميع المستخدمين في جدول
- عرض معلومات كل مستخدم:
  - اسم المستخدم
  - اسم الفرع
- حذف مستخدم

#### إدارة الصلاحيات:
- اختيار مستخدم لتعديل صلاحياته
- تعديل الصلاحيات التالية:
  - **صفحة الخطوط** (`cards`): الوصول إلى صفحة إدارة الخطوط
  - **صفحة التقارير** (`reports`): الوصول إلى صفحة التقارير
  - **صفحة الإعدادات** (`sittings`): الوصول إلى صفحة الإعدادات
- تفعيل/تعطيل الحساب (`active`)

**التبويبات:**
- المستخدمين: عرض قائمة المستخدمين
- الصلاحيات: إدارة صلاحيات المستخدمين

**الحالة:**
- `users`: قائمة المستخدمين
- `permissions`: صلاحيات المستخدم المحدد
- `selectedUser`: المستخدم المحدد
- `active`: التبويب النشط

---

### 7. القائمة الجانبية (`components/SideBar/page.jsx`)

**الوظيفة:** شريط التنقل الرئيسي في التطبيق

**ما تفعله:**

#### عرض الروابط:
- عرض روابط الصفحات المتاحة حسب صلاحيات المستخدم
- الروابط المتاحة:
  - **المبيعات اليومية** (`/`): دائماً متاح لجميع المستخدمين
  - **الخطوط** (`/cards`): يحتاج صلاحية `cards`
  - **التقارير** (`/reports`): يحتاج صلاحية `reports`
  - **الإعدادات** (`/sittings`): يحتاج صلاحية `sittings`

#### تسجيل الخروج:
- زر تسجيل الخروج
- مسح بيانات `localStorage`
- إعادة تحميل الصفحة

**الحالة:**
- `users`: قائمة المستخدمين (للتحقق من الصلاحيات)
- `permissions`: صلاحيات المستخدم الحالي
- `userName`: اسم المستخدم الحالي

---

### 8. إعدادات Firebase (`app/firebase.jsx`)

**الوظيفة:** تهيئة اتصال Firebase مع قاعدة البيانات

**ما تفعله:**
- تهيئة تطبيق Firebase
- تصدير كائن قاعدة البيانات (`db`) للاستخدام في جميع المكونات

**المجموعات (Collections) المستخدمة:**
- `users`: بيانات المستخدمين
- `cards`: بيانات الخطوط
- `operations`: العمليات اليومية
- `reports`: التقارير المحفوظة

---

## نظام الصلاحيات

### هيكل الصلاحيات:
```javascript
{
  cards: boolean,      // الوصول إلى صفحة الخطوط
  reports: boolean,   // الوصول إلى صفحة التقارير
  sittings: boolean,  // الوصول إلى صفحة الإعدادات
  active: boolean     // تفعيل/تعطيل الحساب
}
```

### المستخدمون ذوو الصلاحيات الكاملة:
- "محمد شعبان ايرور 3"
- "محمد شعبان ايرور 2"
- "محمد شعبان ايرور 1"
- "admin1"

هؤلاء المستخدمون يمكنهم:
- إضافة/تعديل/حذف الخطوط
- الوصول إلى جميع الصفحات

---

## نظام الحدود الشهرية

### آلية العمل:
1. عند إضافة خط جديد، يتم حفظ الحدود الأصلية (`originalDepositLimit`, `originalWithdrawLimit`)
2. في بداية كل شهر، يتم إعادة ضبط الحدود تلقائياً
3. حد الاستلام يتم حسابه بناءً على الرصيد الحالي:
   ```
   withdrawLimit = originalWithdrawLimit - amount
   ```

### إعادة الضبط الشهرية:
- تحدث تلقائياً عند فتح صفحة الخطوط
- تحافظ على جميع العمليات السابقة
- تعيد الحدود إلى قيمها الأصلية

---

## التخزين المحلي (LocalStorage)

### البيانات المحفوظة:
- `userName`: اسم المستخدم
- `shop`: اسم الفرع

### الاستخدام:
- التحقق من حالة تسجيل الدخول
- تحديد الفرع الحالي
- تصفية البيانات حسب الفرع

---

## كيفية التشغيل

### المتطلبات:
- Node.js 18.x أو أحدث
- npm أو yarn أو pnpm

### خطوات التشغيل:

1. تثبيت المكتبات:
```bash
npm install
# أو
yarn install
# أو
pnpm install
```

2. تشغيل خادم التطوير:
```bash
npm run dev
# أو
yarn dev
# أو
pnpm dev
```

3. فتح المتصفح:
افتح [http://localhost:3000](http://localhost:3000) في المتصفح

### بناء المشروع للإنتاج:
```bash
npm run build
npm start
```

---

## الميزات الرئيسية

✅ نظام تسجيل دخول آمن مع التحقق من الصلاحيات  
✅ إدارة كاملة للخطوط الهاتفية  
✅ نظام عمليات مالية (إرسال/استلام) مع حدود شهرية  
✅ تقارير يومية مفصلة  
✅ نظام صلاحيات مرن  
✅ واجهة مستخدم عربية كاملة  
✅ تحديث البيانات في الوقت الفعلي  
✅ إدارة الحدود الشهرية التلقائية  
✅ حساب الأرباح والعمولات تلقائياً  

---

## ملاحظات مهمة

⚠️ **الأمان:**
- كلمات المرور مخزنة كنص عادي في قاعدة البيانات (يُنصح بتشفيرها)
- API Key الخاص بـ Firebase مرئي في الكود (يُنصح بنقله إلى متغيرات البيئة)

⚠️ **الأداء:**
- استخدام `onSnapshot` للتحديثات الفورية قد يستهلك موارد إضافية
- يُنصح بإضافة نظام pagination للجداول الكبيرة

⚠️ **التحسينات المقترحة:**
- إضافة نظام تشفير لكلمات المرور
- نقل إعدادات Firebase إلى متغيرات البيئة
- إضافة نظام pagination
- إضافة نظام تصدير Excel للتقارير
- إضافة نظام إشعارات

---

## الدعم والمساعدة

للمساعدة أو الاستفسارات، يرجى التواصل مع فريق التطوير.

---

**تم التطوير باستخدام Next.js و Firebase**
#   e r r o r - v 2 . 0  
 